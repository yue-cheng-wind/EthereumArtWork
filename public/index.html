<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
        crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.2.6/dist/web3.min.js"></script>

    <link rel="stylesheet" href="styles.css">

    <title>Alice's Dreaming Gallery DApp</title>
    
</head>

<body>

    <h1>Alice's Dreaming Gallery DApp</h1>

    <div class="tabs mb-5">
        <input type="radio" id="tab1" name="tab-control" checked>
        <input type="radio" id="tab2" name="tab-control">

        <ul>
            <li title="Features"><label for="tab1" role="button"><span>About Me</span></label></li>
            <li title="Delivery Contents"><label for="tab2" role="button"><span>Gallery</span></label></li>
        </ul>

        <div class="slider">
            <div class="indicator"></div>
        </div>
        <div class="content">
            <!-- tab 1: about me -->
            <section>
                Features go here Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ea dolorem sequi, quo tempore in eum obcaecati atque quibusdam officiis est dolorum minima deleniti ratione molestias numquam. Voluptas voluptates quibusdam cum?
            </section>

            <!-- tab 2: gallery -->
            <section>
                
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="card-group text-center">
                            <div class="card m-3 shadow_css" style="width: 18rem;">
                                <img class="card-img-top" src="./images/1.jpg" alt="Hippopotamus and Crocodile Hunt">
                                <div class="card-body">
                                    <h5 class="card-title" id="art1">Name 1</h5>
                                </div>
            
                                <div class="card-footer">
                                    <button class="btn btn-sm btn-outline-danger" onclick="like(1)">
                                        <i class="fas fa-heart mr-1 text-danger fa-lg"></i>
                                        <span id="art1count">0</span>
                                    </button>
            
                                    <button class="btn btn-sm btn-outline-success" onclick="tip(1)">
                                        <i class="fas fa-donate fa-lg"></i>
                                        <span id="art1tip">0</span>
                                    </button>
                                </div>
                            </div><!-- end card -->
            
                            <div class="card m-3 shadow_css" style="width: 18rem;">
                                <img class="card-img-top" src="./images/2.jpg" alt="The Kiss">
                                <div class="card-body">
                                    <h5 class="card-title" id="art2">Name 2</h5>
                                </div>
            
                                <div class="card-footer">
                                    <button class="btn btn-sm btn-outline-danger" onclick="like(2)">
                                        <i class="fas fa-heart mr-1 text-danger fa-lg"></i>
                                        <span id="art2count">0</span>
                                    </button>
            
                                    <button class="btn btn-sm btn-outline-success" onclick="tip(2)">
                                        <i class="fas fa-donate fa-lg"></i>
                                        <span id="art2tip">0</span>
                                    </button>
                                </div>
                            </div><!-- end card -->
            
                            <div class="card m-3 shadow_css" style="width: 18rem;">
                                <img class="card-img-top" src="./images/3.jpg" alt="The Trapper">
                                <div class="card-body">
                                    <h5 class="card-title" id="art3">Name 3</h5>
                                </div>
            
                                <div class="card-footer">
                                    <button href="#" class="btn btn-sm btn-outline-danger" onclick="like(3)">
                                        <i class="fas fa-heart mr-1 text-danger fa-lg"></i>
                                        <span id="art3count">0</span>
                                    </button>
            
                                    <button class="btn btn-sm btn-outline-success" onclick="tip(3)">
                                        <i class="fas fa-donate fa-lg"></i>
                                        <span id="art3tip">0</span>
                                    </button>
                                </div>
                            </div><!-- end card -->
            
                        </div><!-- end card-group -->
            
                    </div><!-- end row -->
            
                    <div class="row justify-content-center">
                        <div class="card-group text-center">
                            <div class="card m-3 shadow_css" style="width: 18rem;">
                                <img class="card-img-top" src="./images/4.jpg" alt="The Veiled Lady at Mia">
                                <div class="card-body">
                                    <h5 class="card-title" id="art4">Name 4</h5>
                                </div>
            
                                <div class="card-footer">
                                    <button class="btn btn-sm btn-outline-danger" onclick="like(4)">
                                        <i class="fas fa-heart mr-1 text-danger fa-lg"></i>
                                        <span id="art4count">0</span>
                                    </button>
            
                                    <button class="btn btn-sm btn-outline-success" onclick="tip(4)">
                                        <i class="fas fa-donate fa-lg"></i>
                                        <span id="art4tip">0</span>
                                    </button>
                                </div>
                            </div><!-- end card -->
            
                            <div class="card m-3 shadow_css" style="width: 18rem;">
                                <img class="card-img-top" src="./images/5.jpg" alt="Wave Bowl">
                                <div class="card-body">
                                    <h5 class="card-title" id="art5">Name 5</h5>
                                </div>
            
                                <div class="card-footer">
                                    <button class="btn btn-sm btn-outline-danger" onclick="like(5)">
                                        <i class="fas fa-heart mr-1 text-danger fa-lg"></i>
                                        <span id="art5count">0</span>
                                    </button>
            
                                    <button class="btn btn-sm btn-outline-success" onclick="tip(5)">
                                        <i class="fas fa-donate fa-lg"></i>
                                        <span id="art5tip">0</span>
                                    </button>
                                </div>
                            </div><!-- end card -->
                            
                            <div class="card m-3 shadow_css" style="width: 18rem;">
                                <img class="card-img-top" src="./images/6.jpg" alt="Fist Supper">
                                <div class="card-body">
                                    <h5 class="card-title" id="art6">Name 6</h5>
                                </div>
            
                                <div class="card-footer">
                                    <button href="#" class="btn btn-sm btn-outline-danger" onclick="like(6)">
                                        <i class="fas fa-heart mr-1 text-danger fa-lg"></i>
                                        <span id="art6count">0</span>
                                    </button>
            
                                    <button class="btn btn-sm btn-outline-success" onclick="tip(6)">
                                        <i class="fas fa-donate fa-lg"></i>
                                        <span id="art6tip">0</span>
                                    </button>
                                </div>
                            </div><!-- end card -->
            
                        </div><!-- end card-group -->
            
                    </div><!-- end row -->
                    
                </div><!-- end container -->

            </section>
        </div>
    </div> <!-- end tabs -->










    
    

    
    <footer class="fixed-bottom bg-color-light text-center">
        <p class="small mt-5"> Developed with <i class="fas fa-heart mr-1 text-danger"></i>by 
            <a href="https://github.com/yue-cheng-wind/EthereumArtWork.git" class="font-weight-bold text-danger" target="_blank">
            MIS 382N Team2</a>.
            Project demo can be found <a href="#" class="font-weight-bold text-danger">here</a>.
        </p>
    </footer>



    

    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/js/all.min.js"
        integrity="sha256-qM7QTJSlvtPSxVRjVWNM2OfTAz/3k5ovHOKmKXuYMO4=" crossorigin="anonymous"></script>
    <script src="js/contract.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
        integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
        crossorigin="anonymous"></script>

    <script>
        var myContract;
        var myAccount;
        async function CheckMetamaskConnection() {
            // Modern dapp browsers...
            if (window.ethereum) {
                window.web3 = new Web3(window.ethereum);
                try {
                    // Request account access if needed
                    await ethereum.enable();
                    // Acccounts now exposed
                    return true;
                } catch (error) {
                    // User denied account access...
                    return false;
                }
            }
            // Legacy dapp browsers...
            else if (window.web3) {
                window.web3 = new Web3(web3.currentProvider);
                // Acccounts always exposed

                return true;
            }
            // Non-dapp browsers...
            else {
                console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');
                return false;
            }
        }

        $(document).ready(async function () {
            var IsMetamask = await CheckMetamaskConnection();
            if (IsMetamask) {
                myContract = await new web3.eth.Contract(SmartContractABI, SmartContractAddress);

                for (var i = 1; i <= 6; i++) {
                    getArtwork(i);
                }

                console.log("myContract :", myContract);
                console.log("Metamask detected!")

                // get account information
                var myAccounts = await web3.eth.getAccounts()
                myAccount = myAccounts[0]
                console.log("myAccount:", myAccount)

                // get events
                await myContract.events.eventUpdate({
                    fromBlock: 0
                }, function (err, event) {
                    console.log("event detected!")
                    console.log("event :", event);
                    console.log("artwork id", event.returnValues._artworkid)
                    getArtwork(Number(event.returnValues._artworkid));
                });

            } else {
                console.log("Metamask not detected");
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: 'Metamask not detected!',
                    onClose() {
                        location.reload();
                    }
                });
            }
        });

        async function getArtwork(id) {
            await myContract.methods.artworks(id).call().then((result) => {
                console.log("result : ", result);
                document.getElementById("art" + id).innerHTML = result["name"];
                document.getElementById("art" + id + 'count').innerHTML = Number(result["likeCount"]);
                document.getElementById("art" + id + 'tip').innerHTML = Number(result["tipAmount"]);
            })
        }

        async function like(id) {
            await myContract.methods.like(id).send(
                {
                    from: myAccount,
                }
            ).then((res) => {
                console.log("You like it!")
                Swal.fire({
                    icon: 'success',
                    title: 'Thank You!.',
                    text: 'I am deeply thankful for your appreciation!',
                    onClose() {
                        //  location.reload();
                    }
                });

            }).catch((err) => {
                console.error(err);
                return err;
            });
        }


        async function tip(id) {

            console.log("tipping" + id)
            await myContract.methods.tip(id).send(
                {
                    value: 10,
                    from: myAccount,
                }
            ).then((res) => {
                console.log("You tipped it!")
                Swal.fire({
                    icon: 'success',
                    title: 'Thank You!',
                    text: 'Thank you for supporting my inspiration!',
                    onClose() {
                        //  location.reload();
                    }
                });

            }).catch((err) => {
                console.error(err);
                return err;
            });
        }

    </script>

</body>

</html>
